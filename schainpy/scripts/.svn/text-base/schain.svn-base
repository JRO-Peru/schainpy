#!/usr/bin/env python
'''
Created on Jul 7, 2014

@author: roj-idl71
'''
import os, sys

from schainpy import controller_api
from optparse import OptionParser

USAGE = """This script executes Signal Chain using parameters stored in [filename].

$ schain --file=[filename]
"""
    
def main(filename):
    
    controllerObj = controller_api.ControllerThread()
    if not controllerObj.readXml(filename):
        return
    
    #Configure use of external plotter before start
    plotterObj = controllerObj.useExternalPlotter()
    ########################################
    
    controllerObj.start()
    plotterObj.start()
    
    print "Finishing all processes ..."
    
    controllerObj.join(5)
    
    print "End of script"
    
if __name__ == '__main__':
    
    parser = OptionParser(usage=USAGE)

    parser.add_option("-f", "--file", type="string", default="",
                      help="File containing schain parameters")
    
    (op, args) = parser.parse_args()
    
    if not op.file:
        parser.print_help()
        sys.exit(0)
        
    main(op.file)